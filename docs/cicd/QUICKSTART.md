# AutoGeo CI/CD å¿«é€ŸæŒ‡å—

> å¿«é€Ÿäº†è§£å’Œä½¿ç”¨ AutoGeo çš„ CI/CD æµç¨‹

---

## ğŸ“‹ ç›®å½•

1. [CI åŸç†å¯¹æ¯”](#ci-åŸç†å¯¹æ¯”)
2. [æœ¬åœ° CI æµ‹è¯•](#æœ¬åœ°-ci-æµ‹è¯•)
3. [GitHub Actions CI](#github-actions-ci)
4. [Electron æ‰“åŒ…åŸç†](#electron-æ‰“åŒ…åŸç†)
5. [å¸¸è§é—®é¢˜](#å¸¸è§é—®é¢˜)

---

## CI åŸç†å¯¹æ¯”

### åç«¯ CI (FastAPI + Python)

```
ä»£ç æ¨é€ â†’ Lint (Ruff) â†’ ç±»å‹æ£€æŸ¥ (MyPy) â†’ å•å…ƒæµ‹è¯• (Pytest) â†’ Docker æ„å»º â†’ éƒ¨ç½²
```

**ä¸ºä»€ä¹ˆç®€å•ï¼Ÿ**
- âœ… Python æ˜¯è§£é‡Šå‹è¯­è¨€ï¼Œä¸éœ€è¦ç¼–è¯‘
- âœ… ä¾èµ–ç®¡ç†ç®€å• (uv/pip)
- âœ… å•ä¸€è¿è¡Œç¯å¢ƒ (Linux)
- âœ… Docker æ ‡å‡†åŒ–

### å‰ç«¯ CI (Electron + Vue3)

```
ä»£ç æ¨é€ â†’ ESLint â†’ TypeScript â†’ Vitest â†’ Vite Build â†’ Electron æ‰“åŒ… â†’ å‘å¸ƒ
         â†“                    â†“                    â†“
      å¿«é€Ÿæ£€æŸ¥            Web éƒ¨åˆ†æµ‹è¯•         å¤æ‚çš„è·¨å¹³å°æ‰“åŒ…
```

**ä¸ºä»€ä¹ˆå¤æ‚ï¼Ÿ**
- âŒ éœ€è¦è·¨å¹³å°æ„å»º (Linux/Windows/macOS å„è‡ªåªèƒ½æ„å»ºè‡ªå·±å¹³å°)
- âŒ éœ€è¦åŸç”Ÿä¾èµ– (node_modules æœ‰å¾ˆå¤šåŸç”Ÿæ¨¡å—)
- âŒ Electron æ–‡ä»¶å·¨å¤§ (~200MB+)ï¼Œæ„å»ºæ—¶é—´é•¿
- âŒ ä»£ç ç­¾åéœ€è¦è¯ä¹¦

---

## æœ¬åœ° CI æµ‹è¯•

### è¿è¡Œæœ¬åœ° CI

```bash
# è¿›å…¥å‰ç«¯ç›®å½•
cd fronted

# è¿è¡Œå®Œæ•´ CI
node scripts/ci.js

# åªè¿è¡Œå‰ç«¯
node scripts/ci.js --frontend

# åªè¿è¡Œåç«¯
node scripts/ci.js --backend

# è·³è¿‡æµ‹è¯•
node scripts/ci.js --skip-test

# è¯¦ç»†è¾“å‡º
node scripts/ci.js --verbose
```

### CI è¾“å‡ºç¤ºä¾‹

```
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘         AutoGeo æœ¬åœ°è‡ªåŠ¨åŒ– CI è„šæœ¬                       â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

â„¹ é…ç½®: { frontend: true, backend: true, ... }

â–¶ å¼€å§‹å‰ç«¯ CI æ£€æŸ¥...
â„¹ è¿è¡Œ ESLint...
âœ“ ESLint æ£€æŸ¥é€šè¿‡
â„¹ è¿è¡Œ TypeScript ç±»å‹æ£€æŸ¥...
âœ“ TypeScript æ£€æŸ¥é€šè¿‡
â„¹ è¿è¡Œå•å…ƒæµ‹è¯•...
âœ“ å•å…ƒæµ‹è¯•é€šè¿‡
â„¹ æ„å»ºå‰ç«¯...
âœ“ å‰ç«¯æ„å»ºæˆåŠŸ
âœ“ å‰ç«¯ CI å®Œæˆï¼ç”¨æ—¶: 45.23s

============================================================
  CI æŠ¥å‘Š
============================================================

å‰ç«¯:
  âœ“ é€šè¿‡: 4
  âœ— å¤±è´¥: 0
  âŠ˜ è·³è¿‡: 0

  æ­¥éª¤è¯¦æƒ…:
    âœ“ ESLint (5.23s)
    âœ“ TypeScript (8.12s)
    âœ“ Unit Tests (12.45s)
    âœ“ Build (19.43s)

============================================================
æ€»è®¡: âœ“ 4 | âœ— 0 | âŠ˜ 0

ğŸ‰ æ‰€æœ‰æ£€æŸ¥é€šè¿‡ï¼å¯ä»¥å®‰å…¨æ¨é€ä»£ç äº†ï¼
```

---

## GitHub Actions CI

### è§¦å‘ CI

```bash
# æ¨é€ä»£ç è§¦å‘ CI
git push origin master

# åˆ›å»º PR è§¦å‘ CI
gh pr create --title "æ–°åŠŸèƒ½" --body "æè¿°"

# æ‰“æ ‡ç­¾è§¦å‘å‘å¸ƒ
git tag v2.4.0
git push origin v2.4.0
```

### CI å·¥ä½œæµ

| æ–‡ä»¶ | è§¦å‘æ¡ä»¶ | å†…å®¹ |
|------|---------|------|
| `frontend-ci.yml` | push/PR to fronted/** | Lint + Test + Build |
| `frontend-release.yml` | push tag v*.*.* | è·¨å¹³å°æ‰“åŒ… + å‘å¸ƒ |
| `backend-ci.yml` | push/PR to backend/** | Lint + Test + å®‰å…¨æ‰«æ |
| `backend-deploy.yml` | push to master | Docker æ„å»º + éƒ¨ç½² |

---

## Electron æ‰“åŒ…åŸç†

### æ‰“åŒ…æµç¨‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  1. Vite Build (æ¸²æŸ“è¿›ç¨‹)                                    â”‚
â”‚     pnpm run build:renderer                                 â”‚
â”‚     â†’ ç”Ÿæˆ dist/ ç›®å½• (HTML/JS/CSS)                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  2. Electron ç¼–è¯‘ (ä¸»è¿›ç¨‹)                                   â”‚
â”‚     pnpm run build:electron                                 â”‚
â”‚     â†’ ç”Ÿæˆ electron/main/*.js                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  3. electron-builder æ‰“åŒ…                                    â”‚
â”‚     pnpm run dist                                           â”‚
â”‚     â†“                                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  a) ä¸‹è½½ Electron äºŒè¿›åˆ¶ (~200MB)                       â”‚ â”‚
â”‚  â”‚  b) æ‰“åŒ… Vite æ„å»ºäº§ç‰©                                   â”‚ â”‚
â”‚  â”‚  c) æ‰“åŒ…ä¸»è¿›ç¨‹ä»£ç                                        â”‚ â”‚
â”‚  â”‚  d) ç”Ÿæˆå®‰è£…åŒ…                                           â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚     â†“                                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                           â”‚
â”‚  â”‚ Windows â”‚  macOS  â”‚  Linux  â”‚                           â”‚
â”‚  â”‚ .exe    â”‚  .dmg   â”‚.AppImageâ”‚                           â”‚
â”‚  â”‚ .msi    â”‚  .zip   â”‚ .deb    â”‚                           â”‚
â”‚  â”‚         â”‚         â”‚ .rpm    â”‚                           â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### è·¨å¹³å°æ„å»ºç­–ç•¥

```yaml
# æ¯ä¸ªå¹³å°åªèƒ½æ„å»ºè‡ªå·±çš„åŒ…ï¼
strategy:
  matrix:
    include:
      - os: ubuntu-latest
        platform: linux
        target: [AppImage, deb, rpm]
      - os: windows-latest
        platform: windows
        target: [nsis, portable]
      - os: macos-latest
        platform: macos
        target: [dmg, zip]
```

---

## å¸¸è§é—®é¢˜

### Q1: ä¸ºä»€ä¹ˆ Electron CI è¿™ä¹ˆæ…¢ï¼Ÿ

**A:** Electron CI æ…¢çš„åŸå› ï¼š

1. **ä¸‹è½½ Electron äºŒè¿›åˆ¶** (~200MBï¼Œæ¯æ¬¡éƒ½è¦ä¸‹è½½)
2. **è·¨å¹³å°æ„å»º** éœ€è¦åœ¨ 3 ä¸ª OS ä¸Šåˆ†åˆ«è¿è¡Œ
3. **Playwright æµè§ˆå™¨** éœ€è¦å•ç‹¬ä¸‹è½½ Chromium
4. **åŸç”Ÿæ¨¡å—ç¼–è¯‘** node-gyp ç¼–è¯‘éœ€è¦æ—¶é—´

**ä¼˜åŒ–æ–¹æ¡ˆï¼š**
- ä½¿ç”¨ GitHub Actions ç¼“å­˜
- ä½¿ç”¨ electron-builder çš„é¢„æ„å»ºäºŒè¿›åˆ¶
- è€ƒè™‘ä½¿ç”¨ [electron-builder.com](https://www.electron.build/) äº‘æœåŠ¡

### Q2: ä»£ç ç­¾åæ€ä¹ˆåšï¼Ÿ

**Windows:**
```bash
# è´­ä¹°ä»£ç ç­¾åè¯ä¹¦ (DigiCert, Sectigo ç­‰)
# é…ç½® GitHub Secrets:
WIN_CSC_LINK=your-certificate-file
WIN_CSC_KEY_PASSWORD=your-password
```

**macOS:**
```bash
# éœ€è¦è‹¹æœå¼€å‘è€…è´¦å· ($99/å¹´)
# é…ç½® GitHub Secrets:
CSC_LINK=your-certificate-file
CSC_KEY_PASSWORD=your-password
APPLE_ID=your-apple-id
APPLE_ID_PASSWORD=app-specific-password
APPLE_TEAM_ID=your-team-id
```

### Q3: å¦‚ä½•åœ¨æœ¬åœ°æµ‹è¯• Electron æ‰“åŒ…ï¼Ÿ

```bash
# è¿›å…¥å‰ç«¯ç›®å½•
cd fronted

# å®‰è£…ä¾èµ–
npm install

# æ„å»º
npm run build

# æ‰“åŒ… (å½“å‰å¹³å°)
npm run dist

# åªæ‰“åŒ… Windows (åœ¨ Windows ä¸Š)
npm run dist:win

# åªæ‰“åŒ… macOS (åœ¨ macOS ä¸Š)
npm run dist:mac

# åªæ‰“åŒ… Linux (åœ¨ Linux ä¸Š)
npm run dist:linux
```

### Q4: CI å¤±è´¥äº†æ€ä¹ˆåŠï¼Ÿ

```bash
# 1. å…ˆåœ¨æœ¬åœ°è·‘ CI
node scripts/ci.js --verbose

# 2. æŸ¥çœ‹ GitHub Actions æ—¥å¿—
gh run view [run-id]

# 3. æœ¬åœ°é‡ç°é—®é¢˜
# (æŒ‰ç…§ CI æ­¥éª¤æ‰‹åŠ¨æ‰§è¡Œ)

# 4. ä¿®å¤åé‡æ–°æ¨é€
git add .
git commit -m "fix: ä¿®å¤ CI é—®é¢˜"
git push
```

---

## æ–‡ä»¶æ¸…å•

| æ–‡ä»¶ | è¯´æ˜ |
|------|------|
| `.github/workflows/frontend-ci.yml` | å‰ç«¯ CI |
| `.github/workflows/frontend-release.yml` | å‰ç«¯å‘å¸ƒ |
| `.github/workflows/backend-ci.yml` | åç«¯ CI |
| `.github/workflows/backend-deploy.yml` | åç«¯éƒ¨ç½² |
| `fronted/scripts/ci.js` | æœ¬åœ° CI è„šæœ¬ |
| `fronted/electron-builder.yml` | Electron æ‰“åŒ…é…ç½® |
| `fronted/scripts/before-build.js` | æ„å»ºå‰è„šæœ¬ |
| `fronted/scripts/after-pack.js` | æ‰“åŒ…åè„šæœ¬ |

---

**æœ€åæ›´æ–°**: 2026-02-11
**ç»´æŠ¤è€…**: è€ç‹
